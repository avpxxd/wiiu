<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AVPxxd's Wii U Dev Tools</title>
    <style>
        body {
            background-color: #000;
            color: #00ff00;
            font-family: "Courier New", monospace;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }
        .header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .grid { display: block; }
        .row { margin: 10px 0; font-size: 20px; }
        .label { color: #888; }
        .val { color: #fff; font-weight: bold; }
        #log {
            margin-top: 20px;
            height: 150px;
            border-top: 1px solid #333;
            overflow: hidden;
            font-size: 14px;
            color: #aaa;
        }
        .btn-active { color: #00ff00; background: #111; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="margin:0;">Wii U LIVE DATA</h1>
        <div id="status" style="color: yellow;">INITIALIZING...</div>
    </div>

    <div class="grid">
        <div class="row"><span class="label">BUTTONS: </span><span id="btn-hex" class="val">0x00000000</span></div>
        <div class="row"><span class="label">L-STICK: </span><span id="l-stick" class="val">0, 0</span></div>
        <div class="row"><span class="label">R-STICK: </span><span id="r-stick" class="val">0, 0</span></div>
        <div class="row"><span class="label">GYRO PITCH:</span><span id="gyro" class="val">0.00</span></div>
    </div>

    <div id="log">--- INPUT LOG START ---<br></div>

    <script type="text/javascript">
        var lastBtn = 0;
        var logEl = document.getElementById('log');

        function addToLog(msg) {
            var entry = document.createElement('div');
            entry.innerHTML = "> " + msg;
            logEl.insertBefore(entry, logEl.firstChild);
            // Keep log short to save Wii U memory
            if (logEl.childNodes.length > 8) { logEl.removeChild(logEl.lastChild); }
        }

        function update() {
            if (window.wiiu && window.wiiu.gamepad) {
                var state = window.wiiu.gamepad.update();

                if (state.isEnabled) {
                    document.getElementById('status').innerHTML = "CONNECTED @ 60FPS";
                    document.getElementById('status').style.color = "#0f0";

                    // Update live values
                    document.getElementById('btn-hex').innerHTML = "0x" + state.hold.toString(16).toUpperCase();
                    document.getElementById('l-stick').innerHTML = state.lStickX.toFixed(2) + ", " + state.lStickY.toFixed(2);
                    document.getElementById('r-stick').innerHTML = state.rStickX.toFixed(2) + ", " + state.rStickY.toFixed(2);
                    document.getElementById('gyro').innerHTML = state.gyroPitch.toFixed(4);

                    // If a new button is pressed, log it
                    if (state.hold !== lastBtn && state.hold !== 0) {
                        addToLog("Button State Changed: 0x" + state.hold.toString(16));
                    }
                    lastBtn = state.hold;
                } else {
                    document.getElementById('status').innerHTML = "WAITING FOR GAMEPAD...";
                    document.getElementById('status').style.color = "red";
                }
            } else {
                document.getElementById('status').innerHTML = "ERROR: NOT A WII U BROWSER";
            }

            // This is the "Refresh Constantly" part
            window.webkitRequestAnimationFrame(update);
        }

        // Kick off the loop
        update();
    </script>
</body>
</html>
